<!DOCTYPE html>
<html><head><title>Archives - Page 162</title><link rel="stylesheet" type="text/css" href="static/css/index.css"/></head><body><section class="article-list"><article><h2>Getting a YouTube FLV through PHP</h2><time>October 4, 2009</time><div><p><img src="http://images.dxprog.com/blog/php_corner.png" alt="" title="PHP Corner">
Recently, while making some additions to the <a href="http://labs.dxprog.com/smp/">Music Page</a>, I came across the need to get the location of a YouTube FLV. Unfortunately, most of my googling turned up outdated results that no longer work. Fortunately, unlike a certain <a href="http://hulu.com/">other</a> site, it&#39;s not impossible. Below is a quick explanation of what I got to work. I&#39;ll be assuming that you know how to get your hands on the video ID (the &quot;v&quot; parameter in the query string).[break]</p>
<p>There really is only one thing that&#39;s needed by YouTube to get the video file, and that&#39;s the video token. As far as I can tell, this is a time sensitive key that is generated for the user to prevent abuse on the YouTube servers. Luckily, this is pretty easy to obtain. The get_video_info page returns not only the token, but all sorts of other valuable information about the video, such as author, date uploaded, length in seconds, etc. Here&#39;s a small function that retrieves this information and returns it as an object:</p>
<p>[code=php]function ytGetInfo ($id)
{
    $file = file_get_contents (&quot;<a href="http://www.youtube.com/get_video_info?&amp;video_id=$id">http://www.youtube.com/get_video_info?&amp;video_id=$id</a>&quot;);
    $a = explode (&quot;&amp;&quot;, urldecode ($file));
    foreach ($a as $i) {
        $e = explode (&quot;=&quot;, $i, 2);
        $ret-&gt;$e[0] = $e[1];
    }
    return $ret;
}[/code]</p>
<p>Simple stuff, really. The contents of get_video_info are retrieved and stored in $file. This information comes URL encoded, so we first need to decode that. As with any URL string, each variable is separated by an ampersand (&amp;), so when calling <a href="http://us.php.net/manual/en/function.explode.php">explode</a>. That returns the variable/value pairs in an array ([0]=&gt;&quot;author=dxprog&quot;, [1]=&gt;&quot;token=asi940tnas&quot;, ...). Iterating through each of those, we then explode the var/value pairs and add them to our outgoing object. Now we have the token (amongst other info), so next will be retrieving the video file itself.</p>
<p>YouTube uses get_video to return where the actual video is stored. Now, I don&#39;t know all the nuances of this method, but as of this writing, it returns a 303 See other HTTP response code with the location header pointing to the actual, real address of the video file. We&#39;ll functionize that:</p>
<pre><code class="lang-php">function ytGetVideoPath ($id)
{
    $info = ytGetInfo ($id);
    $token = $info-&gt;token;
    $headers = get_headers (&quot;http://www.youtube.com/get_video?video_id=$id&amp;t=$token&amp;fmt=18&quot;);
    foreach ($headers as $item) {
        if (strpos ($item, &quot;Location: &quot;) !== false) {
            return str_replace (&quot;Location: &quot;, &quot;&quot;, $item);
        }
    }
    return false;
}
</code></pre>
<p>First thing this function does is grab the video information so that we can get the token. We then retrieve the headers of the video providing the video ID <em>(v)</em> and the token <em>(t)</em> as parameters to get_video. The <em>fmt</em> parameter specifies the quality video you want, none being low, 18 being high, and 22 being HD. Using the <a href="http://us.php.net/manual/en/function.get-headers.php">get_headers</a> function, we should be returned a 303 response code with the location header set to the video location. I can&#39;t guarantee that this is always the case, but it hasn&#39;t failed me yet.</p>
<p>From here, you can do with the returned URL as you please. You can use <a href="http://us.php.net/manual/en/function.file-get-contents.php">file_get_contents</a> or <a href="http://us.php.net/manual/en/function.fsockopen.php">fsockopen</a> - my favorite - to download the stream, load it into your flash video player or whatever you want. I hope you found this little guide useful. If you run into any problems with the above code, please leave a comment below and I&#39;d be happy to help. Cheers!</p>
</div></article><article><h2>Pretty pictures abound</h2><time>September 27, 2009</time><div><p>In the downtime during my ever continuing quest for employment, I&#39;ve taken up a few extra hobbies to keep from going completely bored. <a href="http://labs.dxprog.com/twitstats/">Some</a> are more <a href="http://dxprog.com/entry/phpgraphs-a-php-graph-drawing-library/">relevent</a> to my future line of work, while others are simply for my enjoyment.</p>
<p>One thing that I&#39;ve attempted to take up again is drawing. My skills currently sit somewhere between mediocre and decent, a stat I&#39;d certainly like to level up. So, my brother Chris and I have periodically enjoyed an evening of drawing while watching the nerdy sitcom, <a href="http://en.wikipedia.org/wiki/The_Big_Bang_Theory">Big Bang Theory</a>. Unfortunately, we&#39;ve finished the first two seasons and now are forced to wait a week for new episodes, as the third season just began. For the off days, BBT has been summarily replaced with Pinky and the Brain.</p>
<p>In keeping with my new found - and probably unhealthy - fascination with the land of the rising sun, I&#39;ve been taking cues from the manga/anime style (much of which is fan art). So, for those who enjoy that sort of thing, here&#39;s a gallery of some of the artwork I&#39;ve created over the lest month and a half.</p>
<p>[gallery=Summer 2009 Art]<img src="http://images.dxprog.com/artwork/Konata.jpg" alt="" title="Konata Izumi from Lucky Star. My first crack at getting back into drawing and, arguably, the worst"><img src="http://images.dxprog.com/artwork/Tsukasa.jpg" alt="" title="Tsukasa Hiiragi. Another piece of fanart from Lucky Star. This has replaced my long standing Yoko desktop wallpper."><img src="http://images.dxprog.com/artwork/Midori_sketch.jpg" alt="" title="Midori Kasugano of Midori Days. Probably the most bizarre premise to a story I&#39;ve yet encountered, but it was funny and endearing; a throughly enjoyable read/watch."><img src="http://images.dxprog.com/artwork/Keri.jpg" alt="" title="A character of my own devise. I named her Keri."><img src="http://images.dxprog.com/artwork/Haruhi.jpg" alt="" title="Haruhi Suzumiya. Probably one of the best sci-fi/highschool mash-ups I&#39;ve ever seen. Well, the only one I&#39;ve seen."><img src="http://images.dxprog.com/artwork/Nia_sketch.jpg" alt="" title="Nia... somebody, straight out of Gurren Laggan. This anime kicked the BallZ right out of Dragon Ball">[/gallery]</p>
<p>So, there it is. You probably noticed that there&#39;s a bit of a common theme to the above pictures (beyond the manga/anime thing). If you didn&#39;t, you lose five points and get no cookie.</p>
</div></article></section></body></html>