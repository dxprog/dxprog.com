<!DOCTYPE html>
<html><head><title>Archives - Page 163</title><link rel="stylesheet" type="text/css" href="static/css/index.css"/></head><body><section class="article-list"><article><h2>phpGraphs - A PHP Graph Drawing Library</h2><time>September 7, 2009</time><div><p><img src="http://images.dxprog.com/blog/phpgraphs.png" alt="" title="phpGraphs">
Over the past few days, I&#39;ve been developing a library to help in drawing graphs for various stuff on the <a href="http://dxprog.com/entry/celebrating-one-year-of-the-music-page">music page</a>. I&#39;ve built to to be a fairly complete solution that is both robust and simple to use. Today, I offer phpGraphs to the masses to do with as they please, <a href="http://dxprog.com/files/phpGraphs_1.0.zip">free of charge.</a> Follow the break for a quick tutorial on how to use it.[break]
phpGraphs requires PHP5 and the GD2 extension to be enabled. To install, simply copy the phpGraph.php to a place accessible to your script.
Here&#39;s a small script that sets up the graph object an adds data:</p>
<pre><code class="lang-php">include (&quot;http://dxprog.com/phpGraphs.php&quot;);

$graph = new Graph (&quot;My Graph&quot;, 640, 480);
$dataSet = $graph-&gt;createDataSet (&quot;Data Set 1&quot;);
for ($i = 0; $i &lt; 50; $i++)
    $dataSet-&gt;add (rand () % 100);
</code></pre>
<p><strong>Line 2 - </strong>Here, we include the phpGraph library. Pretty self-explanitory.
<strong>Line 4 - </strong>We create our graph object in the variable $graph. The argument passed is the title that will be drawn at the top of the graph. The second two parameters are the width and height of the image, respectively.
<strong>Line 5 - </strong>This creates a new dataset with the name &quot;Data Set 1&quot;. It returns a pointer to the dataset object within the graph object. You can create an infinite amount of data sets, though there is a visual limitation I will discuss later.
<strong>Line 6 - </strong>Calling the <em>add</em> function of the object returned on line 5 will add data to the set, in this case a random number from 0 to 100.
phpGraphs has the ability to draw four different types of graph. They are: line, vertical bar, horizontal bar and pie. Following is an example of each graph type along with the function prototype.
<img src="http://dxprog.com/pics/phpGraphs_line.png" alt="" title="Line Graph">
[code=prototype]image drawLineGraph (xLabel, yLabel, [drawLegend = true], [divisions = 5]);[/code]
<img src="http://dxprog.com/pics/phpGraphs_vbar.png" alt="" title="Vertical Bar Graph">
[code=prototype]image drawVertBarGraph (yLabel, [drawLegend = true], [divisions = 5]);[/code]
<img src="http://dxprog.com/pics/phpGraphs_hbar.png" alt="" title="Horizontal Bar Graph">
[code=prototype]image drawHorzBarGraph (yLabel, [drawLegend = true], [divisions = 5]);[/code]
<img src="http://dxprog.com/pics/phpGraphs_pie.png" alt="" title="Pie Graph">
[code=prototype]image $graph-&gt;drawPieGraph ([drawLegend = true]);[/code]
All of these are functions of the Graph object and aach returns a handle to a GD image that you can do with as you please. Some notes on the parameters:
_xLabel - _Label to be drawn on the X axis
_yLabel - _Label to be drawn on the Y axis
_showLegend - _Defines whether to show the legend or not. This is turned on by default. If the legend is disabled, the graph will enlarge to fill the image.
<em>divisions - </em> This says how many times to divide up the Y axis (X for horizontal bar graphs). The default is 5, which should work well in most cases.</p></p>
<p><p>By default, phpGraphs has colors set for text, image background, data background, grid, and twelve colors for data sets. Now, as I mentioned above, you can have an infinite amount of data sets, but after the twelfth the color will be black as no colors are set beyond that. phpGraphs, however, gives you complete control over the colors you wish to use. The functions are as follows:</p>
[code=prototype]Graph-&gt;setBgColor (r, g, b, [a = 0x00]);
Graph-&gt;setDataBgColor (r, g, b, [a = 0x00]);
Graph-&gt;setTextColor (r, g, b, [a = 0x00]);
Graph-&gt;setGridColor (r, g, b, [a = 0x00]);
Graph-&gt;setDataColor (index, r, g, b, [a = 0x00]);[/code]
_r, g, b - _The red, green and blue values of the color. Valid value range is 0-255.
<em>a</em> - Alpha of the color. Valid values are 0-127, with 0 being completely opaque and 127 being completely transparent.
_index - _setDataColor allows you to change the color of the lines, bars and slices used for data. The index value specifies the data set number. Valid valus are 1-infinity.
Below is an example of a graph that has a custom color scheme:
<img src="http://dxprog.com/pics/phpGraphs_custom.png" alt="" title="A graph using custom colors">
Expounding upon the example given above, here is how a complete script would look.</p>
<pre><code class="lang-php">include (&quot;http://dxprog.com/phpGraphs.php&quot;);

// Create the graph and add some data
$graph = new Graph (&quot;My Graph&quot;, 640, 480);
$dataSet = $graph-&gt;createDataSet (&quot;Data Set 1&quot;);
for ($i = 0; $i &lt; 50; $i++)
    $dataSet-&gt;add (rand () % 100);

// Draw the graph
$img = $graph-&gt;drawLineGraph (&quot;Iteration&quot;, &quot;Value&quot;, false);

// Add the appropriate headers so the browser recognizes this as an image
header (&quot;Content-type: image/png&quot;);
imagepng ($img);
imagedestroy ($img);
</code></pre>
<p>That&#39;s about all there is to it. If you find any bugs, have any feature requests, or are just having issues, feel free to leave a comment below and I&#39;ll be glad to help. Enjoy!</p>
<p>[ <a href="http://dxprog.com/files/phpGraphs_1.0.zip">Download</a> ]</p>
</div></article><article><h2>Celebrating One Year of the Music Page</h2><time>September 1, 2009</time><div><p>For the casual frequenter of my blog, you&#39;ve probably seen me mention the illustrious <a href="http://dxprog.com/entry/building-a-web-based-media-player---part-1/">Music Page</a> before. It has been my pet project for a year now and has been the catalyst for a few leaps in coding practice for me. Firstly, it&#39;s responsible for my becoming quite adept at advanced &quot;OOP&quot;-like JavaScript-ing. Secondly, it&#39;s given me an outlet to try out new things such as dynamic graphs in PHP or using Bing&#39;s search API. Let&#39;s take a brief walk through history.[break]</p>
<p>One thing I&#39;ll mention about the Page that has been intrinsic to every version: the whole concept is based on disposable playlists. Unlike iTunes or Windows Media Player which has you going through a huge list either right clicking to add to playing or ctrl-selecting and dragging off into a permanent playlist, the Music Page queues up songs in a single click, which I believe makes it a whole lot faster and easier to set up whatever music I want to listen to.</p>
<p><strong>The First Version</strong>
[url=<a href="http://dxprog.com/pics/music_page_1.jpg]![](http://dxprog.com/pics/music_page_1.jpg">http://dxprog.com/pics/music_page_1.jpg]![](http://dxprog.com/pics/music_page_1.jpg</a> &quot;Music Page v1&quot;)[/url]
The first version of this project was really just a front end for playing MP3s through my server and didn&#39;t actually involve any streaming at all. It was more of a &quot;see if a can&quot; type thing without any real plans for fleshing out a full app. That didn&#39;t come until I decided to throw in a the Flash app.</p>
<p>I don&#39;t remember exactly why I decided to create the streaming player; perhaps so I could listen to my music while I was working at school. In fact, I believe I started this project in the month I had my PHP class. While everyone else was struggling trying to create the simple home page that was required, I was off doing extra-curricular activities. An ass I am.</p>
<p>The page pretty much stayed like this for quite some time. Somewhere, I moved everything to two columns and added playlist support, but that was it. No fancy effects, no JavaScripty goodness. Hell, it didn&#39;t even get a look refresh until November when I made a Christmas theme.
[url=<a href="http://dxprog.com/pics/music_page_1_winter.jpg]![](http://dxprog.com/pics/music_page_1_winter.jpg">http://dxprog.com/pics/music_page_1_winter.jpg]![](http://dxprog.com/pics/music_page_1_winter.jpg</a> &quot;Music Page v1 - Winter Theme&quot;)[/url]</p>
<p><strong>Music Page v2</strong>
[url=<a href="http://dxprog.com/pics/music_page_2.jpg]![](http://dxprog.com/pics/music_page_2.jpg">http://dxprog.com/pics/music_page_2.jpg]![](http://dxprog.com/pics/music_page_2.jpg</a> &quot;Music Page v2&quot;)[/url]
The second revision of the page saw quite a lot of additional features. The first big change was completely dropping PHP for any kind of front end job. Instead, it handled data management and everything else was handled by JavaScript through Ajax. This was the real beginning of my JavaScript coding days. I&#39;d been piddling around with jQuery for a little bit before, but now I brought it out in force.</p>
<p>The second major update was the layout. Instead of having a giant list of everything off to the right like you see in most desktop media players, I hid all the track names and moved the album list to left. This, coupled with the addition of album art thumbnails and the larger font for album names, made it far easier to find the songs I was looking for. Additionally, I also included the ability to save playlists.</p>
<p>Finally, another welcome feature, was the inline upload form (not shown). Using a bunch of Ajax calls and a little C++ application to grab ID3 tags, I was able to quickly upload a whole bunch of songs without having to go to a different page or worry about page refresh due to form submission. This made the addition of music a thousand times easier. However, a page refresh was still required to update the album list on the left.</p>
<p>But, as had happened with the first one, I began shoe-horning features on that the original code base and design had never been intended for. So, I began work on the be all and end all of the Music Page.</p>
<p><strong>Music Page Rev. 3</strong>
[url=<a href="http://dxprog.com/pics/music_page_3.jpg]![](http://dxprog.com/pics/music_page_3.jpg">http://dxprog.com/pics/music_page_3.jpg]![](http://dxprog.com/pics/music_page_3.jpg</a> &quot;Music Page Rev. 3&quot;)[/url]
With the current iteration, I&#39;ve rewritten the entire code base from ground up (except the PHP stuff. It&#39;s stayed mostly the same). This is more of a evolutionary revision as opposed to the revolutionary of v2.</p>
<p>Again, this version has seen PHP kicked even more to the curb by revoking its right to sort all the data before sending it to the page script. All of the tracks are loaded and sorted on the fly in JavaScript, which allows me to fully update the album list whenever I wish, such as after the addition of new MP3s.</p>
<p>In visual changes, I moved all the playlist data off to the right and added pages for each of the various functions. This makes the left column much less cluttered while giving the other functions the time of day they deserve. Also, by creating the paged portal, I leave plenty of room for me to expand in the future. This has already come in handy as I&#39;ve been adding features the last couple days that weren&#39;t originally intended.</p>
<p>First is the play history graph, as seen in the picture above. Before, I&#39;d been using a <a href="http://twitter.com/dxmusic">twitter account</a> to track my play history (and, somewhat successfully, last.fm before that). However, I&#39;m now storing play history in a local table in the database for the sole purpose of tracking stats (another page I could add in the future). The second feature is the addition of inline album art search.</p>
<p>[url=<a href="http://dxprog.com/pics/music_page_3_art.jpg]![](http://dxprog.com/pics/music_page_3_art.jpg">http://dxprog.com/pics/music_page_3_art.jpg]![](http://dxprog.com/pics/music_page_3_art.jpg</a> &quot;Music Page Rev. 3 - Album Art Search&quot;)[/url]
Using the Bing API (because Google&#39;s doesn&#39;t do image search), you can scour the webs to locate, download and set album art. The text box shown above is filled with the name of the album by default, but you&#39;re able to enter in custom terms and search to your heart&#39;s content until you find what you want.</p>
<p>So there&#39;s a history of what the Music Page has gone through. It&#39;s been quite an adventure pulling this thing together and I&#39;ve certainly learned a lot from the experience. The one thing that I think makes this project sweeter than just a fun past time is the fact that it&#39;s a viable application. I literally have not used any desktop music player since I created this thing (my brothers too). Being that I actually use it on a day-to-day basis gives me an advantage in seeing what&#39;s working, what&#39;s not and what I would like to added. I wish all projects could work out this well.</p>
</div></article></section></body></html>